{"version":3,"sources":["../../scripts/main.ts","../../scripts/maintenance.ts"],"sourcesContent":["import { world, system, ChatSendAfterEvent, PlayerJoinAfterEvent, PlayerSpawnAfterEvent } from \"@minecraft/server\";\nimport { version_documentation } from \"./maintenance\";\n\n// Globals\nconst BP_VERSION = 1;\nconst START_TICK = 100;\nconst VERSION_CHECK_SCOREBOARD = \"VERSION_CHECK_SCOREBOARD\"\nconst HOME_LOCATION_SCOREBOARD = \"HOME_LOCATION_SCOREBOARD\"\nconst SERVER_NAME = \"서버\"\n\n// Entry Points\nsystem.run(mainSetup);\nworld.afterEvents.chatSend.subscribe(onPlayerChatSend)\nworld.afterEvents.playerSpawn.subscribe(onPlayerSpawn)\n\nlet initCounter = 0\n\n// Setup Function\nfunction mainSetup() {\n  if (initCounter < START_TICK){\n    initCounter++;\n    system.run(mainSetup);\n    return;\n  }\n}\n\n// Player Spawn Hook\nfunction onPlayerSpawn(eventData: PlayerSpawnAfterEvent){\n  if (!eventData.initialSpawn) {return;}\n  eventData.player.sendMessage(`${eventData.player.name}, ${SERVER_NAME}에 접속한 것을 환영합니다!`)\n  eventData.player.sendMessage(`현재시간은 ${world.getDay()}일 ${Math.floor(world.getTimeOfDay()/ 1000)}시 ${Math.floor((world.getTimeOfDay() % 1000) / 1000 * 60)}분 입니다.`)\n  let joinedString = world.getAllPlayers().map(player => player.name).join(', ');\n  eventData.player.sendMessage(\"현재 접속자는 \" + joinedString +\"입니다.\");\n    \n  let vcScoreboard = world.scoreboard.getObjective(VERSION_CHECK_SCOREBOARD)\n  \n  // Initialize scoreboards if not present.\n  if (!vcScoreboard){\n    vcScoreboard = world.scoreboard.addObjective(VERSION_CHECK_SCOREBOARD, \"Player-Versions\")\n  }\n\n  // Add player if not present.\n  let is_newbie = false\n  let is_version_upgrade = false\n  if (!vcScoreboard.hasParticipant(eventData.player)){\n    is_newbie = true\n    is_version_upgrade = true\n  } else {\n    var s = vcScoreboard.getScore(eventData.player) \n    if (s != undefined && s != BP_VERSION){\n      is_version_upgrade = true\n    }\n  }\n  vcScoreboard.setScore(eventData.player, BP_VERSION)\n  if (is_version_upgrade){\n    eventData.player.sendMessage(`====================================`)\n    eventData.player.sendMessage(`서버가 업데이트되었습니다. (-> ${BP_VERSION})`)\n    if(BP_VERSION in version_documentation){\n      eventData.player.sendMessage(`추가 내용:`)\n      for (let message of version_documentation[BP_VERSION]){\n        eventData.player.sendMessage(\"    \" + message as string)\n      }\n    }\n  }\n  eventData.player.sendMessage(`====================================`)\n}\n\nfunction onPlayerChatSend(eventData: ChatSendAfterEvent){\n  \n  let player = eventData.sender\n  let messageComponents = eventData.message.split(\" \")\n\n  if (messageComponents.length == 0) return\n  switch (messageComponents[0]){\n  \n    case \"!tp\": {\n      if (messageComponents.length != 2){\n        player.sendMessage(`tp > 사용법 '!tp <playername>'`)\n        player.sendMessage(\"접속중인 사용자:\")\n        world.getAllPlayers().forEach(target => {\n          player.sendMessage(\"    \" + target.name);\n        });\n        return\n      }\n      for (let target of world.getAllPlayers()) {\n        if (target.name == messageComponents[1]){\n          let tpSuccess = player.tryTeleport(target.location, {dimension: target.dimension})\n          if (tpSuccess){\n            player.sendMessage(`tp > ${target.name}에게 소환되었습니다.`)\n          } else {\n            player.sendMessage(`tp > ${target.name}는 현재 소환할 수 있는 위치가 아닙니다.`)\n          }\n          return\n        }\n      }\n      player.sendMessage(`tp > 이름 ${messageComponents[1]}은 유효하지 않습니다.`)\n      player.sendMessage(\"접속중인 사용자:\")\n      world.getAllPlayers().forEach(target => {\n        player.sendMessage(\"    \" + target.name);\n      });\n      return\n    }\n\n    case \"!sethome\": {\n      if (player.dimension.id != \"minecraft:overworld\") {\n        player.sendMessage(`sethome > 홈 설정은 오버월드에서만 가능합니다.`)\n        return\n      }\n      let hlScoreboard = world.scoreboard.getObjective(HOME_LOCATION_SCOREBOARD)\n  \n      // Initialize scoreboards if not present.\n      if (!hlScoreboard){\n        hlScoreboard = world.scoreboard.addObjective(HOME_LOCATION_SCOREBOARD, \"Home-Location\")\n      }\n\n      hlScoreboard.setScore(\"x\", player.location.x)\n      hlScoreboard.setScore(\"y\", player.location.y)\n      hlScoreboard.setScore(\"z\", player.location.z)\n      \n      player.sendMessage(`sethome > 성공!`)\n      return\n      \n    }\n\n    case \"!home\": {\n      let hlScoreboard = world.scoreboard.getObjective(HOME_LOCATION_SCOREBOARD)\n  \n      if (!hlScoreboard){\n        player.sendMessage(`home > 집 위치가 설정되지 않았습니다.`)\n        return\n      }\n      let px = hlScoreboard.getScore(\"x\")\n      let py = hlScoreboard.getScore(\"y\")\n      let pz = hlScoreboard.getScore(\"z\")\n      if( px != undefined && py != undefined && pz != undefined){\n        let tpSuccess = player.tryTeleport({x: px, y: py, z: pz}, {dimension: world.getDimension(\"minecraft:overworld\")})\n          if (tpSuccess){\n            player.sendMessage(`home > 집으로 소환되었습니다.`)\n          } else {\n            player.sendMessage(`home > 집은 현재 소환할 수 있는 위치가 아닙니다.`)\n          }\n          return\n      }\n\n      player.sendMessage(`home > 오류`)\n      return\n    }\n \n  }\n}\n","export const version_documentation = {\r\n  0 : [\"!tp <사용자 이름> -> 사용자에게 순간이동함.\"],\r\n  1 : [\"!home -> 집으로 tp\"]\r\n}"],"mappings":"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","names":[],"file":"../scripts/main.js"}